"undefined"==typeof YAHOO&&(YAHOO={}),void 0===YAHOO.JP&&(YAHOO.JP={}),void 0===YAHOO.JP.Spider&&(YAHOO.JP.Spider={}),YAHOO.JP.Spider.Follow={_CUSTOM:{},_IS_FOLLOW_FLAG:!1,init:function(s){var e,o=this;o._CUSTOM=s,o._IS_FOLLOW_FLAG=!1,_sec=s.sec||"",_sid=s.sid||"",_vtestid=s.vtestid||"",_v_pkjp=s.v_pkjp||"",_followed_panel_id=s.followedPanelId||"",_is_vertical=s.isVertical||"",_error_panel_id=s.errorPanelId||"",_frameid=s.frameId;var t=document.referrer.split("?")[0];$(window).bind("load",function(){var s=document.referrer.split("/")[2];"news.yahoo.co.jp"!==s&&"headlines.yahoo.co.jp"!==s||$("div.flw_list, div.flw_single").addClass("yjNews")});var l="#"+_followed_panel_id,i="#"+_error_panel_id,n=!1,a=!1;$("."+this._CUSTOM.btnClass).on("touchstart",function(s){n=!1,a=!0}),$("."+this._CUSTOM.btnClass).on("touchmove",function(s){n=!0}),$("."+this._CUSTOM.btnClass).on("click touchend",function(s){if(s.preventDefault(),!("touchend"===s.type&&n||"click"===s.type&&a)){var e=$(this).parent(".follow").attr("tid"),r=$(this).parent(".follow").attr("dtype"),d=$(this).parent(".follow").attr("pos")||"";if(l="#"+_followed_panel_id,i="#"+_error_panel_id,o._CUSTOM.isVertical){var f=$(this).parents("li.listVerticalBody__item").index();l+=f=(f-f%3)/3,i+=f}if(o.panelCancel(_frameid,l,i),o._CUSTOM.loginUrlBase&&o._CUSTOM.markupUrlBase){var p=o._CUSTOM.markupUrlBase.replace(/&.done/,"&tid="+e+"&referrer="+t+"&.done"),c=o._CUSTOM.loginUrlBase+"&.done="+encodeURIComponent(p);parent.location.href=c}$(this).hasClass("dofollow")?(""!==_sid&&""!==_sec&&(YAHOO.JP.Spider.PluginPostUlt.follow(_sid,_sec,"follow",e,d,_vtestid,_v_pkjp),YAHOO.JP.Spider.PluginPostUlt.recommend(_sid,e)),o.follow(e,r,_frameid,_sid,l,i,t)):($(this).hasClass("dounfollow")||$(this).hasClass("following"))&&(""!==_sid&&""!==_sec&&YAHOO.JP.Spider.PluginPostUlt.follow(_sid,_sec,"followoff",e,d,_vtestid,_v_pkjp),o.unfollow(e,r,_frameid,_sid,l,i,t))}}),this._CUSTOM.errorTxt=$("."+this._CUSTOM.btnClass).parent().find(".error"),this._CUSTOM.errorTxt.length>0&&($("."+this._CUSTOM.btnClass).hide(),this._CUSTOM.errorTxt.hide().fadeIn("fast"),this._CUSTOM.errorTxt.click(function(s){s.preventDefault(),o.hideErrorTxt()}),e=window.setTimeout(function(){window.clearTimeout(e),o.hideErrorTxt()},3e3))},hideErrorTxt:function(){var s=this;s._CUSTOM.errorTxt.length>0&&s._CUSTOM.errorTxt.fadeOut("fast",function(){s._CUSTOM.errorTxt.remove(),$("."+s._CUSTOM.btnClass).fadeIn()})},errorCommonProcess:function(s,e){var o=this,t="btn_"+e;$(".follow").find("."+o._CUSTOM.btnClass+"."+t).attr("class",o._CUSTOM.btnClass+" "+t).addClass("alert").find("span").html("エラー");var l=window.setTimeout(function(){window.clearTimeout(l),"add"===s?$(".follow").find("."+o._CUSTOM.btnClass+"."+t).attr("class",o._CUSTOM.btnClass+" "+t).addClass("dofollow").hide().fadeIn().find("span").html("フォロー"):"del"===s&&$(".follow").find("."+o._CUSTOM.btnClass+"."+t).attr("class",o._CUSTOM.btnClass+" "+t).addClass("following").hide().fadeIn().find("span").html("フォロー中")},3e3)},follow:function(s,e,o,t,l,i,n){this.submitRequest(s,e,"add",o,t,l,i,n)},unfollow:function(s,e,o,t,l,i,n){this.submitRequest(s,e,"del",o,t,l,i,n)},submitRequest:function(s,e,o,t,l,i,n,a){var r=this,d="btn_"+s,f={tid:s,dtype:e,sid:l,action:o,referrer:a,".crumb":r._CUSTOM.crumb};$(".follow").find("."+r._CUSTOM.btnClass+"."+d).attr("class",r._CUSTOM.btnClass+" "+d).addClass("processing").find("span").html("処理中..."),$follow_url="https:"==document.location.protocol?"/plugin/Markup/FollowProcess/":"/Markup/FollowProcess/",$.ajax({type:"POST",url:$follow_url,data:f,dataType:"json",success:function(e){void 0===e.ResultSet||1===e.ResultSet.Result?r.errorCommonProcess(o,s):0===e.ResultSet.Result?"add"===o?($(".follow").find("."+r._CUSTOM.btnClass+"."+d).attr("class",r._CUSTOM.btnClass+" "+d).addClass("following").find("span").html("フォロー中"),e.ResultSet.TotalCount>0&&$("#appShare").length>0&&$(i).removeClass("yjMessage--first"),r._IS_FOLLOW_FLAG||(r._IS_FOLLOW_FLAG=!0,r.displayPanel("show",i,t)),r.postMessageToStatus(s,"follow")):"del"===o&&($(".follow").find("."+r._CUSTOM.btnClass+"."+d).attr("class",r._CUSTOM.btnClass+" "+d).addClass("dofollow").find("span").html("フォロー"),r.displayPanel("hide",i,t),r.postMessageToStatus(s,"unfollow")):2===e.ResultSet.Result&&(r.errorCommonProcess(o,s),r.displayPanel("show",n,t))},error:function(e,t,l){r.errorCommonProcess(o,s)}})},displayPanel:function(s,e,o){var t=this,l=$(e);"show"===s&&"none"===l.css("display")?(l.fadeIn("50"),t.postMessageToResize(o)):"hide"===s&&"block"===l.css("display")&&l.fadeOut("10",function(){t.postMessageToResize(o)})},panelCancel:function(s,e,o){var t=this;$(e).find(".cancel").on("click",function(){$(e).fadeOut("10",function(){t.postMessageToResize(s)})}),$(o).find(".cancel").on("click",function(){$(o).fadeOut("10",function(){t.postMessageToResize(s)})})},postMessageToResize:function(s){bodyInfo={frameid:s,height:$("body").height()},parent.postMessage(jQuery.param(bodyInfo),"*")},postMessageToStatus:function(s,e){bodyInfo={theme_id:s,status:e},parent.postMessage(jQuery.param(bodyInfo),"*")}},YAHOO.JP.Spider.PluginPostUlt={follow:function(s,e,o,t,l,i,n){var a=void 0!==i&&""!==i?{cid:t,rpdprop:"spider",vtestid:i,v_pkjp:n}:{cid:t,rpdprop:"spider"},r=void 0!==l&&""!==l?[{links:[{params:{sec:e,slk:o,pos:l}}]}]:[{links:[{params:{sec:e,slk:o}}]}];this.post(a,r,s)},recommend:function(s,e,o){var t=[{links:[{params:{intl:"jp",sec:"ai",ctxid:"1",pkg:e,ccode:o=o||"Nat",cpos:"1",pos:"1",pkgv:"1",et:"v",slk:"app",model:"ofv",coke:"r10010"}}]}];this.post({rpdprop:"spider"},t,s)},post:function(s,e,o){YAHOO.i13n.Beaconer({beacon_server:"ybx.yahoo.co.jp",keys:s,link_data:e,spaceid:o,https:!0}).doClickBeacon(e[0].links[0].params)}};